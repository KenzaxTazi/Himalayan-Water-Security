# Notes for supervision

## 28th May 2020

### Admin and miscellaneous

### Correlations plots

Below are the correlation plots for monthly averaged metrics previously discussed. The correlations are calculate for the whole UIB and the three clusters generated through soft k-means (threshold=0.7). The plots can be updated in real-time using the Copernicus DataStore API for ERA5 data and the NOAA website for the indices.

![cluster map](https://dl.dropboxusercontent.com/s/g73pq99q4w9rw5z/Screenshot%202020-06-01%20at%2023.17.34.png?dl=0)

### Observations

For the whole UIB, we observe the expected strong correlations between:

* __Nino 3.4 and 4 indices.__ These are calculated using spatially near and overlapping measurements. 
* __Total column water vapour (tcwv), 2m dew poit temperature (d2m), and orography (z).__ We expect tcwv to decrease as 
* __Longitude and latitude.__ The distribution of the data is along a South-East to North West axis.

The total precipipition for the whole region is most correlated to the total column water vapour and least correlated to the indices. check? mention others?

![UIB](https://dl.dropboxusercontent.com/s/2plz0hyedfl345x/Screenshot%202020-05-29%20at%2017.12.54.png?dl=0)

Cluster 0:

* correlation decrease to longitude, latitude and local orographic and meteorological variables
* correlation increase to Nino 3.4 and 4 indices

![cluster 0](https://dl.dropboxusercontent.com/s/a3dxtxkf3q0qvty/Screenshot%202020-05-29%20at%2017.13.04.png?dl=0)

Cluster 1:

![cluster 1](https://dl.dropboxusercontent.com/s/az6v41ipjom3vzn/Screenshot%202020-05-29%20at%2017.13.39.png?dl=0)

Cluster 2:

![cluster 2](https://dl.dropboxusercontent.com/s/sjiwmtl1fj714ig/Screenshot%202020-05-29%20at%2017.13.51.png?dl=0)

### GP models

* Switched back to GPflow
* Included a linear mean function for model

#### Precipitation only for one location

Linear mean function, periodic RBF kernel.

![precipitation only](https://dl.dropboxusercontent.com/s/vjv7ht6w3yf6cr2/Screenshot%202020-05-31%20at%2019.07.32.png?dl=0)

| Score | Training | Validation |
| ----- | ---------| ---------- |
| R2    | 0.333    | 0.203      |
| RMSE  | 0.718    | 0.872      |

#### Multiple variables for one location

* Worse than Test RMSE for 2 dimensional model
* is this overfitting?

Linear mean function, RBF kernel for all 9 dimensions.

| Score | Training | Validation |
| ----- | ---------| ---------- |
| R2    | 0.652    | 0.096      |
| RMSE  | 0.666    | 1.212      |

![RBF only residuals](https://dl.dropboxusercontent.com/s/i6geypj4e5lmiln/Screenshot%202020-06-01%20at%2021.43.25.png?dl=0)
![RBF only residuals](https://dl.dropboxusercontent.com/s/ll593d1x9aqpemz/Screenshot%202020-06-03%20at%2013.22.34.png?dl=0)

Linear mean function, periodic RBF kernel for time dimension and RBF for other 8 dimensions.

| Score | Training | Validation |
| ----- | ---------| ---------- |
| R2    | 0.829    | 0.328      |
| RMSE  | 0.328    | 0.904      |

![RBF and periodic RBF on time axes](https://dl.dropboxusercontent.com/s/ohayaq75i48kam4/Screenshot%202020-06-01%20at%2022.34.32.png?dl=0)
![RBF and periodic RBF on time axes residuals](https://dl.dropboxusercontent.com/s/5ud5cx0nf6qup0g/Screenshot%202020-06-03%20at%2013.09.44.png?dl=0){width=50%; float:right}

#### Multiple location for one cluster

Linear mean function, periodic RBF kernel for time dimension and RBF for other 10 dimensions.

| Score | Training | Validation |
| ----- | ---------| ---------- |
| R2    | 0.000    | 0.000      |
| RMSE  | 0.000    | 0.000      |

![RBF and periodic RBF on time axes for clusters](https://dl.dropboxusercontent.com/s)

#### Questions

* Should I use finer resolution data for the predictions data?

### Possible next steps

* Include white noise kernel
* Set up meeting with will Tebutt to discuss how to improve results
* Include variances
* Perform EOF on winds
* Plot residuals
